import { defineNuxtModule, createResolver, addPluginTemplate } from '@nuxt/kit';

const module = defineNuxtModule({
  meta: {
    name: "nuxt-eruda",
    configKey: "eruda"
  },
  defaults: {
    enabled: false,
    initOptions: {},
    plugins: ["eruda-vue"]
  },
  setup(moduleOptions, _nuxt) {
    const resolver = createResolver(import.meta.url);
    if (moduleOptions.enabled) {
      const availablePlugins = moduleOptions.plugins?.map((v) => {
        return {
          name: v,
          const: v.replace("-", "_")
        };
      });
      addPluginTemplate({
        src: resolver.resolve("runtime/plugins/eruda.ejs"),
        filename: "nuxt-eruda-plugin.mjs",
        mode: "client",
        options: {
          ...moduleOptions,
          availablePlugins
        }
      });
    }
  }
});

export { module as default };
